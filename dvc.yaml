stages:
  split_dataset:
    cmd: python ./src/split_dataset.py
    deps:
    - ./data/in-header.tsv
    - ./data/out-header.tsv
    - ./data/parsed-pdfs.json
    - ./src/DatasetSplitter/DatasetSplitter.py
    - ./src/split_dataset.py
    params:
    - datasetsplit.dev
    - datasetsplit.test
    - datasetsplit.train
    - datasetsplit.sort_by
    outs:
    - ./data/dev/expected.tsv
    - ./data/dev/in.tsv
    - ./data/test/expected.tsv
    - ./data/test/in.tsv
    - ./data/train/expected.tsv
    - ./data/train/in.tsv

  rewrite_dataset_to_lm_texts:
    cmd: python ./src/rewrite_dataset.py
    deps:
    - ./src/DatasetRewriter/LanguageModelingRewriter.py
    - ./src/rewrite_dataset.py
    - ./data/dev/in.tsv
    - ./data/test/in.tsv
    - ./data/train/in.tsv
    outs:
    - ./data/dev/lm.txt
    - ./data/test/lm.txt
    - ./data/train/lm.txt
    - ./data/dev/processed.tsv
    - ./data/test/processed.tsv
    - ./data/train/processed.tsv

  train_classifier:
    cmd: python ./src/train_naive_bayes.py
    deps:
    - ./src/SKLearnDS/SKLearnDS.py
    - ./src/train_naive_bayes.py
    - ./data/dev/expected.tsv
    - ./data/dev/processed.tsv
    - ./data/test/expected.tsv
    - ./data/test/processed.tsv
    - ./data/train/expected.tsv
    - ./data/train/processed.tsv
    - ./data/labels.tsv
    params:
    - naive_bayes.outputs
    - naive_bayes.seed
    - naive_bayes.num_training_samples
    outs:
    - ./models/naive_bayes/model.pkl
    - ./models/naive_bayes/vectorizer.pkl
    - ./models/naive_bayes/labels.pkl

  eval_classifier:
    cmd: python ./src/eval.py
    deps:
    - ./src/eval.py
    - ./models/naive_bayes/model.pkl
    - ./models/naive_bayes/vectorizer.pkl
    - ./models/naive_bayes/labels.pkl
    - ./data/labels.tsv
    params:
    - naive_bayes.epsilon
    outs:
    - ./data/dev/out.tsv
    - ./data/test/out.tsv
    metrics:
    - scores_classification.json:
        cache: false
