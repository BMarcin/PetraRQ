schema: '2.0'
stages:
  split_dataset:
    cmd: python ./src/split_dataset.py
    deps:
    - path: ./data/in-header.tsv
      md5: 7ace96be50d1121ab573e6274b0d345b
      size: 12
    - path: ./data/out-header.tsv
      md5: 757889307369887028c89db5646b73de
      size: 7
    - path: ./data/parsed-pdfs.json
      md5: e9b60861734ddc93be6318db98c155e2
      size: 3407420087
    - path: ./src/DatasetSplitter/DatasetSplitter.py
      md5: 74decfd061dccc1e8e9f604ede9ea119
      size: 2315
    - path: ./src/split_dataset.py
      md5: 23feb175f5dfb8fbb9d606608b14e4e2
      size: 4295
    params:
      params.yaml:
        datasetsplit.dev: 0.05
        datasetsplit.sort_by: date
        datasetsplit.test: 0.1
        datasetsplit.train: 0.85
    outs:
    - path: ./data/dev/expected.tsv
      md5: ede893922b331adf870dad11b67be295
      size: 94971
      isexec: true
    - path: ./data/dev/in.tsv
      md5: dafa7c488580f29a63431ce149d6416d
      size: 239789657
      isexec: true
    - path: ./data/test/expected.tsv
      md5: 91df714814cad93605ee6896113114cd
      size: 181433
      isexec: true
    - path: ./data/test/in.tsv
      md5: 965f5c51903a86b4627d19a578eaa5b4
      size: 388966317
      isexec: true
    - path: ./data/train/expected.tsv
      md5: 16d9ea238addf0b5afed8fd7ec17200c
      size: 1559312
      isexec: true
    - path: ./data/train/in.tsv
      md5: a2d8dfd76ceed3e0278f714429cd1fd1
      size: 2621612493
      isexec: true
  rewrite_dataset_to_lm_texts:
    cmd: python ./src/rewrite_dataset.py
    deps:
    - path: ./data/dev/in.tsv
      md5: dafa7c488580f29a63431ce149d6416d
      size: 239789657
    - path: ./data/test/in.tsv
      md5: 965f5c51903a86b4627d19a578eaa5b4
      size: 388966317
    - path: ./data/train/in.tsv
      md5: a2d8dfd76ceed3e0278f714429cd1fd1
      size: 2621612493
    - path: ./src/DatasetRewriter/LanguageModelingRewriter.py
      md5: da1e1d32ff54803854ca0fbb0b7054b4
      size: 1532
    - path: ./src/rewrite_dataset.py
      md5: 2feb4ef0cb9eaec8bf89af21690d4ffb
      size: 2006
    outs:
    - path: ./data/dev/lm.txt
      md5: 3ded16b3953922cceaa90923883a7147
      size: 215738076
      isexec: true
    - path: ./data/dev/processed.tsv
      md5: 3ded16b3953922cceaa90923883a7147
      size: 215738076
      isexec: true
    - path: ./data/test/lm.txt
      md5: 61ed2915525aa2acd50189a964ddc46a
      size: 348233057
      isexec: true
    - path: ./data/test/processed.tsv
      md5: 61ed2915525aa2acd50189a964ddc46a
      size: 348233057
      isexec: true
    - path: ./data/train/lm.txt
      md5: 5928e0910854642a694527f5d062f636
      size: 2391144197
      isexec: true
    - path: ./data/train/processed.tsv
      md5: 5928e0910854642a694527f5d062f636
      size: 2391144197
      isexec: true
  train_lm:
    cmd: python ./src/train_roberta_lm.py
    deps:
    - path: ./data/dev/lm.txt
      md5: 3ded16b3953922cceaa90923883a7147
      size: 215738076
    - path: ./data/labels.tsv
      md5: e16bcdbc2b4c6c92d285156fd0cfd011
      size: 254
    - path: ./data/test/lm.txt
      md5: 61ed2915525aa2acd50189a964ddc46a
      size: 348233057
    - path: ./data/train/lm.txt
      md5: 5928e0910854642a694527f5d062f636
      size: 2391144197
    - path: ./src/train_roberta_lm.py
      md5: bf9791f613267cfe36918ea14d9b798a
      size: 5095
    params:
      params.yaml:
        language_modeling_train.epochs: 200
        language_modeling_train.hidden_dropout_prob: 0.1
        language_modeling_train.hidden_size: 768
        language_modeling_train.max_seq_length: 512
        language_modeling_train.mlm_probability: 0.15
        language_modeling_train.num_attention_heads: 12
        language_modeling_train.num_hidden_layers: 12
        language_modeling_train.seed: 42
        language_modeling_train.tokenizer_min_frequency: 2
        language_modeling_train.vocab_size: 16000
    outs:
    - path: ./models/roberta_lm/config.json
      md5: fb932332aa81d1ad848d0889dabb64ec
      size: 637
    - path: ./models/roberta_lm/merges.txt
      md5: cec421c01956b7d8ae22cc754331a35f
      size: 145988
    - path: ./models/roberta_lm/pytorch_model.bin
      md5: f4e4219fa51a2ea7c3e199878ab9cb3d
      size: 393462571
    - path: ./models/roberta_lm/special_tokens_map.json
      md5: 30d0b45671f60afbb09abb28d04fcfa4
      size: 845
    - path: ./models/roberta_lm/tokenizer.json
      md5: 02a064b4f397df62600c55adeb4c0e81
      size: 666006
    - path: ./models/roberta_lm/tokenizer_config.json
      md5: a22d94c14d5cc34c59e5b4ad42506208
      size: 1155
    - path: ./models/roberta_lm/vocab.json
      md5: c089e0d5dd42b586b543d468552b5430
      size: 247826
    - path: scores.json
      md5: 0cb723a1d2ee842704be485dbe90f5a3
      size: 74
  train_classifier:
    cmd: python ./src/train_roberta_classifier.py
    deps:
    - path: ./data/dev/expected.tsv
      md5: ede893922b331adf870dad11b67be295
      size: 94971
    - path: ./data/dev/processed.tsv
      md5: 3ded16b3953922cceaa90923883a7147
      size: 215738076
    - path: ./data/labels.tsv
      md5: e16bcdbc2b4c6c92d285156fd0cfd011
      size: 254
    - path: ./data/test/expected.tsv
      md5: 91df714814cad93605ee6896113114cd
      size: 181433
    - path: ./data/test/processed.tsv
      md5: 61ed2915525aa2acd50189a964ddc46a
      size: 348233057
    - path: ./data/train/expected.tsv
      md5: 16d9ea238addf0b5afed8fd7ec17200c
      size: 1559312
    - path: ./data/train/processed.tsv
      md5: 5928e0910854642a694527f5d062f636
      size: 2391144197
    - path: ./models/roberta_lm/config.json
      md5: fb932332aa81d1ad848d0889dabb64ec
      size: 637
    - path: ./models/roberta_lm/merges.txt
      md5: cec421c01956b7d8ae22cc754331a35f
      size: 145988
    - path: ./models/roberta_lm/pytorch_model.bin
      md5: f4e4219fa51a2ea7c3e199878ab9cb3d
      size: 393462571
    - path: ./models/roberta_lm/special_tokens_map.json
      md5: 30d0b45671f60afbb09abb28d04fcfa4
      size: 845
    - path: ./models/roberta_lm/tokenizer.json
      md5: 02a064b4f397df62600c55adeb4c0e81
      size: 666006
    - path: ./models/roberta_lm/tokenizer_config.json
      md5: a22d94c14d5cc34c59e5b4ad42506208
      size: 1155
    - path: ./models/roberta_lm/vocab.json
      md5: c089e0d5dd42b586b543d468552b5430
      size: 247826
    - path: ./src/ClassificationDataset/ClassificationDataset.py
      md5: 1fcb0427fc78b90816d7689b023e6049
      size: 1813
    - path: ./src/train_roberta_classifier.py
      md5: 3384e6a9fd5ec5586c06708e60998eec
      size: 6633
    - path: ./src/train_roberta_classifier.py
      md5: 3384e6a9fd5ec5586c06708e60998eec
      size: 6633
    params:
      params.yaml:
        classification_train.num_train_epochs: 20
        classification_train.num_training_samples: -1
        classification_train.seed: 42
        classification_train.warmup_steps: 500
    outs:
    - path: ./models/roberta_classifier/config.json
      md5: ca135cd1e0629cc6be91dce9834c7f64
      size: 1539
    - path: ./models/roberta_classifier/pytorch_model.bin
      md5: c3ab6f93887de1e62e801b0e9e4a8427
      size: 393450541
  evaluate_classifier:
    cmd: python ./src/eval.py
    deps:
    - path: ./models/roberta_classifier/config.json
      md5: ca135cd1e0629cc6be91dce9834c7f64
      size: 1539
    - path: ./models/roberta_classifier/pytorch_model.bin
      md5: c3ab6f93887de1e62e801b0e9e4a8427
      size: 393450541
    - path: ./src/eval.py
      md5: 34716e24e9e367f98a25bc05efbb5292
      size: 9430
    params:
      params.yaml:
        classification_eval.epsilon: 0.01
    outs:
    - path: ./data/dev/out.tsv
      md5: 6e10a460b46aeb9207b125d6a3ba3e5a
      size: 2421452
    - path: ./data/test/out.tsv
      md5: afd72ff76d3941fc12b2583c91509783
      size: 4845324
    - path: scores_classification.json
      md5: 02ec2b966f1f2c77efbf1bdaf0df2b69
      size: 143
